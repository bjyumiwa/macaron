<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>マカロンを選ぶ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body{margin:0;padding:24px;background:#0b0f19;color:#fff;font-family:"Noto Sans JP",sans-serif;text-align:center}
  h2{margin:12px 0 18px}
  .grid{display:grid;grid-template-columns:repeat(4,140px);gap:16px;justify-content:center;margin-top:20px}
  .card{padding:16px;border-radius:16px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);cursor:pointer;user-select:none}
  .card:hover{background:rgba(255,255,255,.14)}
</style>
</head>
<body>
  <h2>マカロンを食べて進化！色を選んでね</h2>
  <div class="grid">
    <div class="card" data-color="pink">ピンク（情熱）</div>
    <div class="card" data-color="blue">ブルー（静寂）</div>
    <div class="card" data-color="green">グリーン（元気）</div>
    <div class="card" data-color="purple">パープル（創造）</div>
  </div>

<script>
  // whoai_* キー（他のファイルと一致させる）
  var K = {
    appear:'whoai_appearance',
    turns :'whoai_cycleCount',
    phase :'whoai_phase',
    flag  :'whoai_newCycleFlag',
    must  :'whoai_must2ndMacaron' // 2回目マカロンの一度きりフラグ
  };

  function pick(color){
    // ★ 進化の確定保存（見た目・フェーズ）
    localStorage.setItem(K.appear, JSON.stringify(color));
    localStorage.setItem(K.phase , JSON.stringify('evolved'));
    localStorage.setItem(K.turns , '0');
    localStorage.setItem(K.flag  , '1');
    localStorage.setItem(K.must  , '0'); // 2回目フラグ消化

    // ちょい演出（0.9秒）
    const ov=document.createElement('div');
    ov.style.cssText='position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.35);color:#fff;font-size:28px';
    ov.textContent='進化しました！';
    document.body.appendChild(ov);

    setTimeout(function(){ location.href = '../whoai_talk.html'; }, 900);
  }

  document.querySelectorAll('.card').forEach(function(el){
    el.addEventListener('click', function(){ pick(el.getAttribute('data-color')); });
  });
</script>
</body>
</html>
