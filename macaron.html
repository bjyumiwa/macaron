<!-- FILE: /macaron/macaron.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>好きなマカロンを選んでね</title>
  <style>
    html,body{height:100%;margin:0}
    body{
      font-family:"Noto Sans JP",sans-serif;
      background:#faf7fb;color:#222;
      display:flex;align-items:center;justify-content:center
    }
    .wrap{width:min(980px,96vw);padding:24px}
    h1{font-size:26px;margin:0 0 22px;text-align:center}
    .grid{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:18px
    }
    .card{
      background:#fff;
      border-radius:18px;
      box-shadow:0 12px 40px rgba(0,0,0,.07);
      padding:18px;text-align:center;
      cursor:pointer;
      transition:transform .12s ease, box-shadow .12s ease
    }
    .card:hover{
      transform:translateY(-2px);
      box-shadow:0 14px 46px rgba(0,0,0,.10)
    }
    .card img{
      width:120px;
      aspect-ratio:1/1;
      object-fit:contain;
      display:block;
      margin:8px auto 10px
    }
    .file-label{
      position:fixed;
      left:10px;bottom:10px;
      font-size:12px;
      opacity:.7
    }

    /* 言語切り替えチップ */
    #langSwitcher {
      position: fixed;
      top: 12px;
      right: 12px;
      z-index: 9999;
      display: flex;
      gap: 6px;
    }
    .lang-chip {
      border: 0;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      background: rgba(0, 0, 0, 0.14);
      color: #fff;
      font-weight: 800;
      cursor: pointer;
    }
    .lang-chip[aria-pressed="true"] {
      outline: 2px solid #ffd1ec;
      background: rgba(255, 209, 236, 0.18);
    }
  </style>
</head>
<body>

  <!-- 言語切り替え -->
  <div id="langSwitcher">
    <button class="lang-chip" data-lang="ja-JP">日本語</button>
    <button class="lang-chip" data-lang="en-US">EN</button>
    <button class="lang-chip" data-lang="zh-CN">中文</button>
    <button class="lang-chip" data-lang="ko-KR">KO</button>
  </div>

  <div class="wrap">
    <h1 id="title">好きなマカロンを選んでね</h1>
    <div class="grid">
      <div class="card" data-color="pink"><img src="public/assets/stage1/macaron_pink.png" alt="pink"></div>
      <div class="card" data-color="blue"><img src="public/assets/stage1/macaron_blue.png" alt="blue"></div>
      <div class="card" data-color="green"><img src="public/assets/stage1/macaron_green.png" alt="green"></div>
      <div class="card" data-color="purple"><img src="public/assets/stage1/macaron_purple.png" alt="purple"></div>
    </div>
  </div>

  <div class="file-label">/macaron/macaron.html</div>

  <script>
    // 多言語タイトルの辞書
    const titleText = {
      "ja-JP": "好きなマカロンを選んでね",
      "en-US": "Choose your favorite macaron",
      "zh-CN": "请选择你喜欢的马卡龙",
      "ko-KR": "좋아하는 마카롱을 골라주세요"
    };

    const UI_LANG_KEY = 'whoai_ui_lang';
    const APP_LANG_KEY = 'whoai_lang';
    const DEFAULT_LANG = 'ja-JP';
    let currentLang = localStorage.getItem(APP_LANG_KEY) || DEFAULT_LANG;

    // 言語適用関数
    function applyI18n(lang) {
      currentLang = lang;
      localStorage.setItem(APP_LANG_KEY, lang);
      localStorage.setItem(UI_LANG_KEY, lang);
      document.documentElement.setAttribute("lang", lang);
      document.getElementById('title').textContent = titleText[lang] || titleText[DEFAULT_LANG];

      // チップの選択状態
      document.querySelectorAll('.lang-chip').forEach(btn => {
        btn.setAttribute('aria-pressed', btn.dataset.lang === lang ? 'true' : 'false');
      });
    }

    // 言語スイッチャーのイベント
    document.getElementById('langSwitcher').addEventListener('click', e => {
      const btn = e.target.closest('.lang-chip');
      if (!btn) return;
      applyI18n(btn.dataset.lang);
    });

    // 初期表示時に適用
    applyI18n(currentLang);

    // マカロン選択処理
    const allowed = ['pink','blue','green','purple'];

    function saveColorAndGo(c){
      const color = (c||'').toLowerCase().trim();
      const chosen = allowed.includes(color)? color : 'green';
      localStorage.setItem('macaronColor', chosen);
      localStorage.setItem('whoai_stage','tane');
      localStorage.setItem('whoai_turn','0');
      localStorage.removeItem('whoai_phase');
      location.href = 'naming.html';
    }

    document.querySelectorAll('.card').forEach(card=>{
      card.addEventListener('click',()=>saveColorAndGo(card.getAttribute('data-color')));
      card.addEventListener('keydown',e=>{
        if(e.key==='Enter'||e.key===' '){
          e.preventDefault(); saveColorAndGo(card.getAttribute('data-color'));
        }
      });
    });
  </script>
</body>
</html>
