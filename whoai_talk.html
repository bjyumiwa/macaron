<script>
(function(){
  function lsGet(k,d=null){try{return JSON.parse(localStorage.getItem(k))??d}catch{return localStorage.getItem(k)??d}}

  const pickedRaw = lsGet('selectedMacaron') || lsGet('whoai_selectedMacaron') || 'green';
  const color = ['pink','blue','green','purple'].includes(pickedRaw) ? pickedRaw : 'green';

  const badge = document.getElementById('whoaiNameBadge');
  const face  = document.getElementById('whoaiBadgeFace');
  const nameEl= document.getElementById('whoaiBadgeText');
  const spriteImg = document.getElementById('whoaiSpriteImg');

  // åå‰è¡¨ç¤º
  nameEl.textContent = `ðŸª„ ${lsGet('characterName','ãªã¾ãˆæœªè¨­å®š')}`;
  badge.style.display = 'inline-block';

  // å€™è£œURLï¼ˆä¸Šã‹ã‚‰é †ã«è©¦ã™ï¼‰
  const candidates = [
    `./public/assets/stage1/tane_${color}.png`,
    `./tane_${color}.png`,
    color==='purple' ? './tane_purplo.png' : null,  // ãƒªãƒã‚¸ãƒˆãƒªã®typoå¯¾ç­–
    './public/assets/stage1/tane_green.png',
    './tane_green.png'
  ].filter(Boolean);

  // 1å›žã ã‘å®Ÿç”»åƒã‚’æ±ºå®š â†’ é¡”ã¨ä¸­å¤®ã«åŒã˜URLã‚’è¨­å®š
  (function pickAndApply(i=0){
    if(i>=candidates.length){ console.warn('tane image not found'); return; }
    const test = new Image();
    test.onload = () => {
      face.src = test.src;
      spriteImg.src = test.src;         // â† ä¸­å¤®ã‚‚åŒã˜URLã‚’ä½¿ã†
    };
    test.onerror = () => pickAndApply(i+1);
    test.src = candidates[i];
  })();
})();
</script>
