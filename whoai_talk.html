<script>
(function(){
  function lsGet(k,d=null){try{return JSON.parse(localStorage.getItem(k))??d}catch{return localStorage.getItem(k)??d}}

  const pickedRaw = lsGet('selectedMacaron') || lsGet('whoai_selectedMacaron') || 'green';
  const color = ['pink','blue','green','purple'].includes(pickedRaw) ? pickedRaw : 'green';

  const badge = document.getElementById('whoaiNameBadge');
  const face  = document.getElementById('whoaiBadgeFace');
  const nameEl= document.getElementById('whoaiBadgeText');
  const spriteImg = document.getElementById('whoaiSpriteImg');

  // 名前表示
  nameEl.textContent = `🪄 ${lsGet('characterName','なまえ未設定')}`;
  badge.style.display = 'inline-block';

  // 候補URL（上から順に試す）
  const candidates = [
    `./public/assets/stage1/tane_${color}.png`,
    `./tane_${color}.png`,
    color==='purple' ? './tane_purplo.png' : null,  // リポジトリのtypo対策
    './public/assets/stage1/tane_green.png',
    './tane_green.png'
  ].filter(Boolean);

  // 1回だけ実画像を決定 → 顔と中央に同じURLを設定
  (function pickAndApply(i=0){
    if(i>=candidates.length){ console.warn('tane image not found'); return; }
    const test = new Image();
    test.onload = () => {
      face.src = test.src;
      spriteImg.src = test.src;         // ← 中央も同じURLを使う
    };
    test.onerror = () => pickAndApply(i+1);
    test.src = candidates[i];
  })();
})();
</script>
