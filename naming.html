<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WhoAI - 名前をつける</title>
  <style>
    html,body{height:100%;margin:0}
    body{
      font-family:"Noto Sans JP",sans-serif;
      background:#faf7fb; color:#222;
      display:flex; align-items:center; justify-content:center;
    }
    .card{background:#fff;border-radius:18px;padding:26px 22px;box-shadow:0 12px 40px rgba(0,0,0,.07);text-align:center;width:min(720px,96vw)}
    .character img{width:160px;display:block;margin:16px auto}
    input{width:70%;padding:12px;border:1px solid #e6e2ee;border-radius:12px;font-size:16px}
    button{padding:12px 16px;border:0;border-radius:12px;font-weight:700;background:#6f4cff;color:#fff;margin-left:8px;cursor:pointer}
    .file-label{position:fixed;left:10px;bottom:10px;font-size:12px;opacity:.7}
  </style>
</head>
<body>
  <div class="card">
    <h1>この子に名前をつけてね</h1>
    <p>あとで変更できます。入力したら「決定！」を押してね。</p>

    <div class="character">
      <img id="taneImg" src="" alt="たねキャラ" onerror="this.src='public/assets/stage1/tane_green.png'">
    </div>

    <div>
      <input id="nameInput" type="text" placeholder="WhoAIの名前を入力" maxlength="24" autofocus>
      <button id="goBtn">決定！</button>
    </div>
    <div style="font-size:12px;opacity:.7;margin-top:10px">※ 入力が空のときは「WhoAI」になります</div>
  </div>

  <div class="file-label">/macaron/naming.html</div>

  <script>
    // 色の決定（green/pink/blue/purple 以外は green）
    const allowed = ['green','pink','blue','purple'];
    let color = (localStorage.getItem('macaronColor') || 'green').toLowerCase();
    if(!allowed.includes(color)) color = 'green';

    // たね画像の設定（キャッシュ回避クエリつき）
    const path = `public/assets/stage1/tane_${color}.png`;
    document.getElementById('taneImg').src = path + `?v=${Date.now()}`;
    console.log('[naming] color=', color, ' img=', document.getElementById('taneImg').src);

    // 名前保存 → macaron.html
    const NAME_KEY = 'whoai_name';
    const DEFAULT_NAME = 'WhoAI';
    const go = ()=>{
      const v = (document.getElementById('nameInput').value || '').trim();
      localStorage.setItem(NAME_KEY, v || DEFAULT_NAME);
      localStorage.setItem('whoai_stage', 'tane');
      location.href = 'macaron.html';
    };
    document.getElementById('goBtn').addEventListener('click', go);
    document.getElementById('nameInput').addEventListener('keydown', e=>{
      if(e.key==='Enter' && !e.isComposing){ e.preventDefault(); go(); }
    });

    // 既存名があれば表示
    const existing = localStorage.getItem(NAME_KEY);
    if(existing) document.getElementById('nameInput').value = existing;
  </script>
</body>
</html>
