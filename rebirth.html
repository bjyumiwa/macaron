<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>復活の儀式（Rebirth）</title>
<style>
  html,body{height:100%;margin:0}
  body{font-family:"Noto Sans JP",sans-serif;color:#fff;background:url("public/assets/stage1/space_background.png") center/cover fixed no-repeat;
    display:flex;align-items:center;justify-content:center;padding:24px}
  .card{max-width:920px;width:92vw;background:rgba(0,0,0,.38);border:1px solid rgba(255,255,255,.18);border-radius:20px;padding:28px;text-align:center}
  h1{margin:0 0 8px}
  .grid{display:grid;gap:16px;grid-template-columns:repeat(2,minmax(220px,1fr));margin-top:16px}
  .opt{background:rgba(255,255,255,.08);border:2px solid transparent;border-radius:16px;padding:16px;cursor:pointer}
  .opt:hover{transform:translateY(-2px)}
  .opt.selected{border-color:#ffc9d6}
  .btn{margin-top:16px;border:none;border-radius:16px;padding:14px 22px;font-weight:700;background:#ffc9d6;color:#222;cursor:pointer}
</style>
</head>
<body>
  <div class="card">
    <h1>復活の儀式</h1>
    <p>どちらを残しますか？（ゲーム体験のための選択です）</p>
    <div class="grid">
      <div class="opt" id="keepAppearance"><h3>容姿を保つ</h3><p>見た目は維持。<br>記憶はリセットされます。</p></div>
      <div class="opt" id="keepMemory"><h3>記憶を保つ</h3><p>会話の記憶は維持。<br>見た目は変化します。</p></div>
    </div>
    <button class="btn" id="go">決定する</button>
  </div>

<script>
const state=JSON.parse(localStorage.getItem('whoai_state')||'{}'); if(!state.color) location.href='macaron_select.html';
let choice=null;
const a=document.getElementById('keepAppearance'), m=document.getElementById('keepMemory');
[a,m].forEach(el=>el.onclick=()=>{choice=(el===a?'appearance':'memory'); a.classList.toggle('selected',choice==='appearance'); m.classList.toggle('selected',choice==='memory');});
document.getElementById('go').onclick=()=>{
  if(!choice) return alert('どちらかを選んでください');
  state.stage='final';
  state.goal=12; state.xp=0;
  state.currentCondition=choice;
  if(choice==='appearance'){
    state.variant='open';
    localStorage.removeItem('whoai_chat'); // 記憶リセット
  }else{
    state.variant='close';                  // 記憶維持
  }
  localStorage.setItem('whoai_state', JSON.stringify(state));
  location.href='whoai_talk.html';
};
</script>
</body>
</html>
