<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>復活の儀式</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  html,body{height:100%;margin:0}
  body{
    font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    color:#fff;
    background:
      radial-gradient(1200px 900px at 85% 25%,rgba(255,255,255,.08),rgba(0,0,0,0) 60%),
      radial-gradient(1200px 900px at 15% 70%,rgba(125,116,255,.15),rgba(0,0,0,0) 60%),
      linear-gradient(180deg,#0a0f1a 0%,#0a0a0a 100%);
    display:flex;align-items:center;justify-content:center;text-align:center;padding:24px
  }
  .card{max-width:720px;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.15);
        border-radius:20px;padding:24px;backdrop-filter:blur(6px)}
  h1{margin:0 0 8px}
  p{opacity:.95;margin:6px 0 18px}
  .choices{display:flex;gap:14px;flex-wrap:wrap;justify-content:center}
  button{padding:12px 18px;border-radius:14px;border:0;cursor:pointer;
         font-weight:800}
  .keep-look{background:#b4f54a;color:#111}
  .keep-mem{background:#9ad0ff;color:#111}
  .ghost{opacity:.7;font-size:.95em;margin-top:10px}
</style>
</head>
<body>
  <div class="card">
    <h1>復活の儀式</h1>
    <p>次の周回の始め方を選んでください。</p>
    <div class="choices">
      <button class="keep-look" id="btnLook">容姿を保つ</button>
      <button class="keep-mem"  id="btnMemo">記録を保つ（見た目だけ変える）</button>
    </div>
    <p class="ghost">※「容姿を保つ」は進化キャラのまま続行。ログと回数はリセットされます。<br>
       「記録を保つ」は会話ログを残したまま色を選び直します。</p>
  </div>

<script>
  // ==== 連携キー（whoai_talk.html と同じ） ====
  var K = {
    log:'whoai_chatLog',
    appear:'whoai_appearance',
    turns:'whoai_cycleCount',
    phase:'whoai_phase',     // 'tane' or 'evolved'
    flag:'whoai_newCycleFlag'
  };

  // ページパス（必要ならファイル名を合わせてください）
  var TALK_URL   = './whoai_talk.html';
  var SELECT_URL = './macaron.html';

  // 容姿（見た目）を保つ：進化キャラのまま続行。ログ・回数はゼロから。
  function keepAppearance(){
    // 見た目は変更しない（whoai_appearance を触らない）
    localStorage.setItem(K.phase, JSON.stringify('evolved')); // 進化フェーズを維持
    localStorage.setItem(K.log,   JSON.stringify([]));        // ログをクリア
    localStorage.setItem(K.turns, '0');                       // 回数をリセット
    localStorage.setItem(K.flag,  '1');                       // 次周開始フラグ
    location.href = TALK_URL;                                 // 会話へ戻る
  }

  // 記録（ログ）を保つ：ログは保持、見た目だけ選び直す
  function keepMemory(){
    // ログは触らない（保持）
    localStorage.setItem(K.phase, JSON.stringify('evolved')); // 次も進化フェーズで続行
    localStorage.setItem(K.turns, '0');                       // 回数だけゼロから
    localStorage.setItem(K.flag,  '1');
    // 見た目を選び直すためにマカロン選択へ
    location.href = SELECT_URL;
  }

  document.getElementById('btnLook').addEventListener('click', keepAppearance);
  document.getElementById('btnMemo').addEventListener('click', keepMemory);
</script>
</body>
</html>
