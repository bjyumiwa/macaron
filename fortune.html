<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>今日の占い ✨</title>
  <style>
    html,body{height:100%;margin:0}
    body{
      font-family:"Noto Sans JP",sans-serif; color:#fff;
      background:url("public/assets/stage1/space_background.png") center/cover fixed no-repeat;
      display:flex; align-items:center; justify-content:center; text-align:center; padding:24px;
    }
    .panel{ width:min(780px,96vw); background:rgba(0,0,0,.45); backdrop-filter:blur(4px);
            border-radius:24px; padding:28px 24px; box-shadow:0 10px 40px rgba(0,0,0,.35)}
    h1{font-size:32px;margin:6px 0 10px;text-shadow:0 2px 12px rgba(0,0,0,.4)}
    p{font-size:18px;margin:0 0 18px;line-height:1.8;opacity:.95}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;background:rgba(255,255,255,.14);font-weight:700}
    .dot{width:12px;height:12px;border-radius:999px;display:inline-block}
    .actions{margin-top:18px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
    .btn{border:0;border-radius:12px;padding:12px 18px;font-weight:800;cursor:pointer}
    .primary{background:#ffd1ec;color:#141217}
    .ghost{background:rgba(255,255,255,.16);color:#fff}
  </style>
</head>
<body>
  <div class="panel">
    <h1>今日の占い ✨</h1>
    <p id="fortuneText">結果を表示中…</p>
    <div class="chip" id="colorChip">
      <span class="dot" id="colorDot"></span>
      <span id="colorName">—</span>
    </div>
    <div class="actions">
      <button id="nextBtn" class="btn primary">次へ</button>
      <button id="rerollBtn" class="btn ghost">引き直し</button>
    </div>
  </div>

  <script>
    const $ = (id)=>document.getElementById(id);
    const params = new URLSearchParams(location.search);

    const TABLE = {
      pink:   { jp:'ピンク（情熱）',   msg:'あなたはとても情熱的。ワクワクする挑戦が、きょうのあなたを前に進めます。' },
      blue:   { jp:'ブルー（静寂）',   msg:'心が澄み、集中の波が来ています。静かな一歩が大きな前進に。' },
      green:  { jp:'グリーン（元気）', msg:'エネルギー満タン！体を動かすほど、良いひらめきが生まれます。' },
      purple: { jp:'パープル（創造）', msg:'あなたはとても創造的で、みんなにインスピレーションを与えるでしょう。' }
    };
    const DOT_COLOR = {pink:'#ff77c8', blue:'#7bb6ff', green:'#5ad269', purple:'#b388ff'};
    const ALLOWED = Object.keys(TABLE);

    function todaySeed(){ const d=new Date(); return d.getFullYear()*10000+(d.getMonth()+1)*100+d.getDate(); }
    function seededPick(seed){ let x=(seed*1664525+1013904223)%4294967296; return ALLOWED[x%4]; }
    function safeColor(c){ return ALLOWED.includes(c)?c:'green'; }

    function chooseColor(){
      const override=params.get('color');
      if(override) return safeColor(override);
      return seededPick(todaySeed());
    }

    function applyFortune(color){
      const t=TABLE[color];
      $('fortuneText').textContent=t.msg;
      $('colorName').textContent=`今日の色：${t.jp}`;
      $('colorDot').style.background=DOT_COLOR[color];
      localStorage.setItem('macaronColor', color);
    }

    let currentColor=chooseColor(); applyFortune(currentColor);

    $('rerollBtn').onclick=()=>{
      const list=ALLOWED.filter(c=>c!==currentColor);
      currentColor=list[Math.floor(Math.random()*list.length)];
      applyFortune(currentColor);
    };

    $('nextBtn').onclick=()=>{
      localStorage.setItem('whoai_stage','tane');
      localStorage.setItem('whoai_turn','0');
      location.href='naming.html';
    };
  </script>
</body>
</html>
