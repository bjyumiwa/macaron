<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>マカロン選択</title>
<style>
  :root{ --glass: rgba(255,255,255,.10); --accent:#ffd1ec; }
  html,body{height:100%;margin:0}
  body{
    font-family:"Noto Sans JP",sans-serif;color:#fff;
    background:url("./space_background.png") center/cover fixed no-repeat;
    display:flex;flex-direction:column;align-items:center;gap:18px;padding:24px
  }
  h1{margin:6px 0 0;text-shadow:0 0 8px rgba(0,0,0,.5)}
  .grid{display:grid;gap:16px;grid-template-columns:repeat(2,minmax(140px,1fr));width:min(560px,92vw)}
  .card{background:var(--glass);border-radius:16px;padding:14px;text-align:center;border:2px solid transparent;cursor:pointer;transition:.12s}
  .card:hover{transform:translateY(-3px);box-shadow:0 10px 20px rgba(0,0,0,.25)}
  .card.selected{border-color:var(--accent);box-shadow:0 0 0 4px rgba(255,209,236,.25) inset}
  .card img{width:94px;height:94px;object-fit:contain;display:block;margin:6px auto 8px}
  .label{font-weight:700}
  .actions{display:flex;gap:12px;margin-top:8px}
  button{padding:10px 16px;border-radius:12px;border:none;font-weight:700;cursor:pointer}
  .next{background:var(--accent);color:#222}.next:disabled{opacity:.6}
  .clear{background:#444;color:#fff}
</style>
</head>
<body>
  <h1>好きなマカロンを選んでね</h1>
  <p>クリックで選択 → 「決定する」で開始。</p>
  <div id="grid" class="grid"></div>
  <div class="actions">
    <button id="clearBtn" class="clear">クリア</button>
    <button id="goBtn" class="next" disabled>決定する</button>
  </div>

<script>
const OPTIONS=[
  {key:"pink",   label:"ピンク",  img:"./macaron_pink.png"},
  {key:"blue",   label:"ブルー",  img:"./macaron_blue.png"},
  {key:"green",  label:"グリーン",img:"./macaron_green.png"},
  {key:"purple", label:"パープル",img:"./macaron_purple.png"}
];
const grid=document.getElementById('grid');
const goBtn=document.getElementById('goBtn');
const clearBtn=document.getElementById('clearBtn');
let selected=null;

OPTIONS.forEach(opt=>{
  const c=document.createElement('div'); c.className='card'; c.dataset.key=opt.key;
  c.innerHTML=`<img src="${opt.img}" alt="${opt.label}"><div class="label">${opt.label}</div>`;
  c.onclick=()=>{
    document.querySelectorAll('.card').forEach(el=>el.classList.remove('selected'));
    c.classList.add('selected'); selected=opt; goBtn.disabled=false;
  };
  grid.appendChild(c);
});
clearBtn.onclick=()=>{document.querySelectorAll('.card').forEach(el=>el.classList.remove('selected'));selected=null;goBtn.disabled=true;};

goBtn.onclick=()=>{
  if(!selected) return;
  // 互換のため2つのキー名に保存
  localStorage.setItem('selectedMacaron', selected.key);
  localStorage.setItem('whoai_selectedMacaron', selected.key);
  // tane で会話開始
  localStorage.setItem('whoai_stage','stage1');
  localStorage.setItem('whoai_appearance','tane');
  localStorage.setItem('whoai_turn_s1','0');
  // 初期章なのでログはクリア（APIには非干渉）
  localStorage.removeItem('whoai_chat');
  localStorage.removeItem('whoai_xp');
  location.href='whoai_talk.html';
};
</script>
</body>
</html>
