<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>evolution.html - ãƒã‚«ãƒ­ãƒ³é€²åŒ–</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: "Noto Sans JP", sans-serif;
      background-image: url("public/assets/stage1/space_background.png");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      color: white;
      text-align: center;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    h2 {
      margin-bottom: 24px;
      font-size: 1.8em;
    }
    .macaron-holder {
      /* ãƒ©ãƒ³ãƒ€ãƒ ã« 1 ã¤ã ã‘è¡¨ç¤º */
      margin-bottom: 24px;
    }
    .macaron-img {
      width: 120px;
      height: auto;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(255,255,255,0.5);
      transition: transform 0.2s;
    }
    .macaron-img:hover {
      transform: scale(1.05);
    }
    .message {
      margin-top: 16px;
      font-size: 1.2em;
      min-height: 1.4em;
    }
    .growth-summary {
      margin-top: 24px;
      background: rgba(255,255,255,0.4);
      color: #222;
      padding: 16px;
      border-radius: 12px;
      max-width: 90%;
      text-align: left;
      display: none; /* é£Ÿã¹çµ‚ãˆãŸã‚‰è¡¨ç¤º */
    }
    .growth-summary h3 {
      margin-top: 0;
    }
    #nextStageBtn {
      margin-top: 32px;
      padding: 12px 24px;
      font-size: 18px;
      border-radius: 12px;
      border: none;
      background: #ffd1ec;
      color: #111;
      cursor: pointer;
      display: none; /* å…¨éƒ¨é£Ÿã¹ãŸã‚‰è¡¨ç¤º */
    }
    #nextStageBtn:hover {
      background: #ff70c1;
      color: white;
    }

    @media screen and (max-width: 480px) {
      .macaron-img {
        width: 90px;
      }
      #nextStageBtn {
        font-size: 16px;
        padding: 10px 20px;
      }
    }
  </style>
</head>

<body>
  <h2>ãƒã‚«ãƒ­ãƒ³ã‚’é£Ÿã¹ã¦é€²åŒ–ã—ã‚ˆã†ï¼</h2>

  <!-- ãƒ©ãƒ³ãƒ€ãƒ ã« 1 ã¤ã ã‘è¡¨ç¤ºã™ã‚‹å ´æ‰€ -->
  <div class="macaron-holder" id="macaronHolder"></div>

  <!-- é£Ÿã¹ãŸã¨ãã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
  <div class="message" id="message"></div>

  <!-- ã“ã‚Œã¾ã§è‚²ã¦ãŸåŠ›ã®ã‚µãƒãƒªãƒ¼ -->
  <div class="growth-summary" id="growthSummary"></div>

  <!-- 4è‰²ã™ã¹ã¦é£Ÿã¹çµ‚ãˆãŸã‚‰è¡¨ç¤ºã•ã‚Œã‚‹ãƒœã‚¿ãƒ³ -->
  <button id="nextStageBtn" onclick="goToRebirth()">å¾©æ´»ã®å„€å¼ã¸ â–¶</button>

  <script>
    // 4è‰²ã®ãƒã‚«ãƒ­ãƒ³ï¼ˆpink, green, blue, purpleï¼‰
    const colors = ["pink","green","blue","purple"];
    const growthMessages = {
      pink:   "ğŸ©· æ€ã„ã‚„ã‚Šãƒ»å…±æ„Ÿã®åŠ›ãŒè‚²ã¡ã¾ã—ãŸ",
      green:  "ğŸ’š è‡ªåˆ†ã‹ã‚‰å‹•ãåŠ›ãŒå‡ºã¦ãã¾ã—ãŸ",
      blue:   "ğŸ’™ æ°—ã¥ã„ã¦è€ƒãˆã‚‹åŠ›ãŒå…‰ã£ã¦ã„ã¾ã™",
      purple: "ğŸ’œ æ„Ÿã˜å–ã£ã¦æ·±ã‚ã‚‹åŠ›ãŒè‚²ã£ã¦ã„ã¾ã™"
    };

    // localStorage ã‹ã‚‰ã“ã‚Œã¾ã§é£Ÿã¹ãŸè‰²ã‚’å–å¾—
    let eaten = JSON.parse(localStorage.getItem("eaten_macarons")) || [];

    // æœªé£ŸçŠ¶æ…‹ã®ãƒã‚«ãƒ­ãƒ³ä¸€è¦§ã‚’è¿”ã™
    function getRemainingColors() {
      return colors.filter(c => !eaten.includes(c));
    }

    // ãƒ©ãƒ³ãƒ€ãƒ ã«æ®‹ã‚Šè‰²ã®ä¸­ã‹ã‚‰ä¸€ã¤ã‚’é¸ã¶
    function pickRandomColor() {
      const remaining = getRemainingColors();
      if (remaining.length === 0) return null;
      return remaining[Math.floor(Math.random() * remaining.length)];
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å‘¼ã³å‡ºã™
    function renderMacaron() {
      const holder = document.getElementById("macaronHolder");
      holder.innerHTML = ""; // ã¾ãšã‚¯ãƒªã‚¢

      const pick = pickRandomColor();
      if (!pick) {
        // å…¨éƒ¨é£Ÿã¹çµ‚ãˆãŸå ´åˆã¯ãƒã‚«ãƒ­ãƒ³ã‚’è¡¨ç¤ºã›ãšã‚µãƒãƒªãƒ¼ã ã‘
        document.getElementById("growthSummary").style.display = "block";
        document.getElementById("nextStageBtn").style.display = "block";
        return;
      }

      // ãƒ©ãƒ³ãƒ€ãƒ ã§é¸ã°ã‚ŒãŸ color ã‚’è¡¨ç¤º
      const img = document.createElement("img");
      img.src = `public/assets/stage1/macaron_${pick}.png`;
      img.alt = pick + "ãƒã‚«ãƒ­ãƒ³";
      img.className = "macaron-img";
      img.onclick = () => eatMacaron(pick);
      holder.appendChild(img);

      // ã‚µãƒãƒªãƒ¼ã¯ã¾ã éè¡¨ç¤ºã®ã¾ã¾
      document.getElementById("growthSummary").style.display = "none";
      document.getElementById("nextStageBtn").style.display = "none";
    }

    // ãƒã‚«ãƒ­ãƒ³ã‚’é£Ÿã¹ãŸã¨ãã®å‡¦ç†
    function eatMacaron(color) {
      if (eaten.includes(color)) return;
      eaten.push(color);
      localStorage.setItem("eaten_macarons", JSON.stringify(eaten));
      document.getElementById("message").textContent = `${color}ãƒã‚«ãƒ­ãƒ³ã‚’é£Ÿã¹ãŸï¼`;
      // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ 2 ç§’ã ã‘è¡¨ç¤º
      setTimeout(() => {
        document.getElementById("message").textContent = "";
      }, 2000);
      // æ¬¡ã®ãƒã‚«ãƒ­ãƒ³ or ã‚µãƒãƒªãƒ¼ã¸åˆ‡ã‚Šæ›¿ãˆ
      renderMacaron();
      renderGrowthSummary();
    }

    // ã“ã‚Œã¾ã§è‚²ã¦ãŸåŠ›ã®ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º
    function renderGrowthSummary() {
      const summaryDiv = document.getElementById("growthSummary");
      if (eaten.length === 0) {
        summaryDiv.innerHTML = "";
        return;
      }
      let html = `<h3>ã‚ãªãŸã¯ã“ã‚“ãªåŠ›ã‚’è‚²ã¦ã¾ã—ãŸâ™ª</h3><ul>`;
      eaten.forEach(color => {
        html += `<li>${growthMessages[color]}</li>`;
      });
      html += `</ul>`;
      summaryDiv.innerHTML = html;
    }

    // ã€Œå¾©æ´»ã®å„€å¼ã¸ â–¶ã€ãƒœã‚¿ãƒ³
    function goToRebirth() {
      window.location.href = "rebirth.html";
    }

    // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰æœ€åˆã«å‘¼ã³å‡ºã—
    window.onload = renderMacaron;
  </script>
</body>
</html>
