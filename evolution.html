<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WHOAI - Evolution</title>
<style>
  html,body{height:100%;margin:0}
  body{
    font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
    background:url("public/assets/stage1/space_background.png") center/cover fixed no-repeat;
    color:#fff; display:flex; align-items:center; justify-content:center; text-align:center; padding:24px
  }
  .card{background:rgba(0,0,0,.38); border:1px solid rgba(255,255,255,.18); border-radius:20px; padding:20px; width:min(760px,92vw)}
  h1{margin:0 0 6px}
  .img{height:160px; display:flex; align-items:center; justify-content:center; margin:10px auto 2px}
  .img img{max-height:160px; max-width:80%; filter:drop-shadow(0 10px 24px rgba(0,0,0,.5))}
  .btn{margin-top:12px; border:none; border-radius:14px; padding:12px 18px; font-weight:700; cursor:pointer; background:#ffd1ec; color:#222}
</style>
</head>
<body>
  <div class="card">
    <h1 id="title">進化</h1>
    <div class="img"><img id="char" alt=""></div>
    <p id="desc"></p>
    <button class="btn" id="go">会話へ進む</button>
  </div>

<script>
  const ASSETS = "public/assets/stage1";
  const state = JSON.parse(localStorage.getItem('whoai_state')||"{}");
  const lang = localStorage.getItem('lang') || 'ja';

  if(!state || !state.color){
    location.href = "macaron_select.html";
  }

  // 画像パス決定
  // 種キャラ：tane_<color>.png（例: tane_pink.png）
  // 進化版：<color>_<variant>.png（例: green_open.png / blue_close.png）
  function charSrc(s){
    if(s.variant === "tane") return `${ASSETS}/tane_${s.color}.png`;
    return `${ASSETS}/${s.color}_${s.variant}.png`;
  }

  document.getElementById('char').src = charSrc(state);

  const N = state.name || "WHOAI";
  const colorName = {pink:"ピンク",blue:"ブルー",green:"グリーン",purple:"パープル"}[state.color] || state.color;

  const text = {
    ja: (state.variant==="tane")
      ? `${N}は ${colorName} のマカロンを食べて「種（tane）」の姿になった！`
      : `${N}は ${colorName} の力が芽吹き、${state.variant==="open"?"オープン":"クローズ"}形態へ進化した！`,
    en: (state.variant==="tane")
      ? `${N} ate the ${state.color} macaron and took on the seed (tane) form!`
      : `${N}'s ${state.color} trait blossomed and evolved to the ${state.variant} form!`
  }[lang];

  document.getElementById('title').textContent = (state.variant==="tane") ? "進化（種）" : "進化（次形態）";
  document.getElementById('desc').textContent = text;

  document.getElementById('go').addEventListener('click', ()=>{
    location.href = "whoai_talk.html";
  });
</script>
</body>
</html>
