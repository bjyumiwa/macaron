<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>evolution.html - マカロン進化</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body { height:100%; margin:0; padding:0; }
    body {
      font-family: "Noto Sans JP", sans-serif;
      background-image: url("public/assets/stage1/space_background.png");
      background-size: cover; background-position: center; background-attachment: fixed;
      color:#fff; text-align:center; padding:20px;
      display:flex; flex-direction:column; justify-content:center; align-items:center;
    }
    h2 { margin-bottom:24px; font-size:1.8em; text-shadow:0 0 8px rgba(0,0,0,.5); }
    .macaron-holder{
      width:140px; height:140px; display:flex; justify-content:center; align-items:center;
      margin-bottom:24px; background:rgba(255,255,255,.1);
      border:2px dashed rgba(255,255,255,.35); border-radius:16px;
    }
    .macaron-img,.evolved-img{
      width:120px; height:auto; border-radius:12px; box-shadow:0 0 10px rgba(255,255,255,.5);
    }
    .macaron-img{ cursor:pointer; transition:transform .2s; }
    .macaron-img:hover{ transform:scale(1.05); }
    .message{ margin-top:16px; font-size:1.2em; min-height:1.4em; }
    #nextStageBtn{
      margin-top:32px; padding:12px 24px; font-size:18px; border:none; border-radius:12px;
      background:#ffd1ec; color:#111; cursor:pointer; display:none;
      transition: background .3s, color .3s;
    }
    #nextStageBtn:hover{ background:#ff70c1; color:#fff; }
    .err{ margin-top:12px; color:#ffdede; display:none; font-size:.95em; }
    @media (max-width:480px){
      .macaron-holder{ width:100px; height:100px; }
      .macaron-img,.evolved-img{ width:80px; }
      #nextStageBtn{ font-size:16px; padding:10px 20px; }
    }
  </style>
</head>
<body>
  <h2>マカロンを食べて進化しよう！</h2>

  <div class="macaron-holder" id="macaronHolder"></div>
  <div class="message" id="message"></div>
  <div class="err" id="err"></div>
  <button id="nextStageBtn" onclick="goToRebirth()">復活の儀式へ ▶</button>

  <script>
    // ===== 言語テキスト =====
    const lang = localStorage.getItem("lang") || "ja";
    document.title = lang === "en" ? "evolution.html - Macaron Evolution" : "evolution.html - マカロン進化";
    document.querySelector("h2").textContent = lang === "en" ? "Feed the macaron to evolve!" : "マカロンを食べて進化しよう！";
    document.getElementById("nextStageBtn").textContent = lang === "en" ? "To the Ritual of Rebirth ▶" : "復活の儀式へ ▶";

    // ===== 画像を表示（緑マカロン） =====
    function renderGreenMacaron(){
      const holder = document.getElementById("macaronHolder");
      const err = document.getElementById("err");
      holder.innerHTML = ""; err.style.display = "none";

      const img = new Image();
      img.src = "public/assets/stage1/macaron_green.png";
      img.alt = "グリーンマカロン";
      img.className = "macaron-img";
      img.onclick = evolveToGreen;
      img.onload = () => holder.appendChild(img);
      img.onerror = () => {
        err.style.display = "block";
        err.textContent = "macaron_green.png が見つかりません。public/assets/stage1/ を確認してください。";
      };
    }

    // ===== 進化処理（green_open.png はリポジトリ直下） =====
    function evolveToGreen(){
      // 進化状態を保存（次ページで使うなら）
      localStorage.setItem("evolved_color", "green");
      localStorage.setItem("evolved_sprite", "green_open");

      const holder = document.getElementById("macaronHolder");
      const err = document.getElementById("err");
      holder.innerHTML = ""; err.style.display = "none";

      // メッセージ
      document.getElementById("message").textContent =
        lang === "en" ? "You ate the green macaron! Evolved to GREEN!" : "グリーンのマカロンを食べた！緑に進化した！";

      // 進化後の画像を直下から読む
      const evo = new Image();
      evo.src = "green_open.png";   // ← リポジトリ直下
      evo.alt = "緑に進化したキャラ";
      evo.className = "evolved-img";
      evo.onload = () => {
        holder.appendChild(evo);
        document.getElementById("nextStageBtn").style.display = "inline-block";
      };
      evo.onerror = () => {
        err.style.display = "block";
        err.textContent = "green_open.png が見つかりません。リポジトリ直下に配置してください。";
      };
    }

    // ===== 次ページへ =====
    function goToRebirth(){ window.location.href = "rebirth.html"; }

    // ===== 初期表示 =====
    window.onload = renderGreenMacaron;
  </script>
</body>
</html>
