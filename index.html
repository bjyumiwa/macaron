<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WhoAI ã‚¹ã‚¿ãƒ¼ãƒˆ</title>
  <style>
    html,body{ height:100%; margin:0; font-family:"Noto Sans JP",sans-serif; }
    body{
      display:flex; align-items:center; justify-content:center; flex-direction:column;
      color:#fff;
      background-image:url("public/assets/stage1/space_background.png");
      background-size:cover; background-position:center; background-attachment:fixed;
      text-align:center; padding:20px;
    }
    .card{
      background:rgba(0,0,0,.55); backdrop-filter:blur(6px);
      border-radius:20px; padding:30px 24px;
      max-width:480px; width:92%;
      box-shadow:0 10px 40px rgba(0,0,0,.4);
    }
    h1{ margin:0 0 12px; font-size:28px }
    p{ margin:0 0 20px; font-size:16px; line-height:1.6 }
    .miwacchi{ width:120px; margin:14px auto; display:block }

    .btn{
      display:inline-block; margin-top:10px; padding:12px 18px; border-radius:12px;
      background:#ffd1ec; color:#141217; font-weight:700; cursor:pointer; text-decoration:none;
    }
    .btn:hover{ opacity:.85 }

    footer{ margin-top:18px; font-size:14px }
    footer a{ color:#ffd1ec; text-decoration:underline }
    footer a:hover{ opacity:1 }

    /* è¨€èªã‚»ãƒ¬ã‚¯ãƒˆï¼ˆå³ä¸Šå›ºå®šï¼‰ */
    .lang-box{
      position:fixed; top:12px; right:12px;
      display:flex; align-items:center; gap:6px;
      background:rgba(0,0,0,.4);
      padding:6px 10px; border-radius:12px;
    }
    .lang-box span{ font-size:16px }
    select{
      padding:6px 10px; border-radius:10px; border:1px solid #444;
      background:#fff; color:#000; font-weight:600; cursor:pointer;
      appearance:none; -webkit-appearance:none; -moz-appearance:none;
    }
    select:focus{ outline:2px solid #ffd1ec; }
  </style>
</head>
<body>
  <!-- è¨€èªã‚»ãƒ¬ã‚¯ãƒˆ -->
  <div class="lang-box" aria-label="UI language">
    <span>ğŸŒ</span>
    <select id="langSelect">
      <option value="ja">æ—¥æœ¬èª</option>
      <option value="en">English</option>
      <option value="zh">ä¸­æ–‡</option>
      <option value="ko">í•œêµ­ì–´</option>
    </select>
  </div>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ -->
  <div class="card" aria-live="polite">
    <h1>WhoAIã¸ã‚ˆã†ã“ã</h1>
    <img src="public/assets/stage1/miwacchi_open.png" alt="ã¿ã‚ã£ã¡" class="miwacchi">
    <p>ã‚ãªãŸã®é¸æŠã§å§¿ã‚’å¤‰ãˆã€é€²åŒ–ã—ã¦ã„ãã¾ã™ã€‚<br>ãŸãã•ã‚“ã®ä¼šè©±ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚</p>
    <!-- ã‚¹ã‚¿ãƒ¼ãƒˆï¼æ¯å›ãƒ•ãƒ«ãƒªã‚»ãƒƒãƒˆï¼‹é·ç§» -->
    <a href="macaron.html" id="startBtn" class="btn">ã¯ã˜ã‚ã‚‹</a>
    <footer>
      <a href="about.html">ã“ã®ç ”ç©¶ã«ã¤ã„ã¦</a>
    </footer>
  </div>

  <script>
    // ===== è¨€èªé¸æŠï¼ˆUIç”¨ & ä¼šè©±ç”¨ã®ä¸¡æ–¹ã«ä¿å­˜ï¼‰ =====
    const UI_LANG_KEY = 'whoai_ui_lang';
    const APP_LANG_KEY = 'whoai_lang'; // ä»¥é™ã®ãƒšãƒ¼ã‚¸ï¼ˆä¼šè©±ï¼‰ã§å‚ç…§
    const sel = document.getElementById('langSelect');

    // éå»ã®ä¿å­˜å€¤ã‚’å„ªå…ˆï¼ˆç„¡ã‘ã‚Œã°jaï¼‰
    const saved = localStorage.getItem(UI_LANG_KEY) || localStorage.getItem(APP_LANG_KEY) || 'ja';
    sel.value = saved;

    sel.addEventListener('change', ()=>{
      const v = sel.value || 'ja';
      localStorage.setItem(UI_LANG_KEY, v);
      localStorage.setItem(APP_LANG_KEY, v);
      // ã‚¢ãƒ©ãƒ¼ãƒˆã¯ãã®ã¾ã¾ï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå´©ã•ãšãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰
      alert("è¨€èªè¨­å®š: " + sel.options[sel.selectedIndex].text);
    });

    // ===== ã‚¹ã‚¿ãƒ¼ãƒˆï¼æ¯å›ãƒ•ãƒ«ãƒªã‚»ãƒƒãƒˆ â†’ macaron.html =====
    document.getElementById('startBtn').addEventListener('click', (e)=>{
      e.preventDefault(); // aã‚¿ã‚°ã®é·ç§»ã‚’ä¸€æ—¦æ­¢ã‚ã‚‹

      // ä»Šé¸ã°ã‚Œã¦ã„ã‚‹è¨€èªã¯å…ˆã«é€€é¿
      const lang = sel.value || 'ja';

      // WhoAI/macaroné–¢é€£ã‚’å…¨å‰Šé™¤ï¼ˆå®Œå…¨åˆæœŸåŒ–ï¼‰
      try{
        Object.keys(localStorage).forEach(k=>{
          if (/^(whoai_|macaron)/.test(k)) localStorage.removeItem(k);
        });
        [
          'whoai_chat','whoai_name','whoai_character_name','whoai_player_name',
          'whoai_stage','whoai_keep','macaronColor','whoai_turn','whoai_phase',
          'whoai_userId','whoai_conversationId'
        ].forEach(k=>localStorage.removeItem(k));
      }catch(err){ console.warn('[reset error]', err); }

      // è¨€èªã ã‘ã¯æŒã¡è¶Šã—ï¼ˆä»¥é™ã®ãƒšãƒ¼ã‚¸ã§ä½¿ç”¨ï¼‰
      localStorage.setItem(UI_LANG_KEY, lang);
      localStorage.setItem(APP_LANG_KEY, lang);

      // ãƒã‚«ãƒ­ãƒ³é¸æŠã¸
      location.href = 'macaron.html';
    });
  </script>
</body>
</html>
